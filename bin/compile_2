#!/bin/sh

# echo "-----> Installing Node.js dependencies"
# npm install --production

# echo "-----> Building static assets"
# npm run build

# echo "-----> Node.js buildpack compile finished"

# echo "The first sh script"
# curl -I www.google.com

#!/bin/bash

# Variáveis de configuração
VAULT_ADDR="https://vault-cgny-41bd57b8411e.herokuapp.com"
VAULT_TOKEN="hvs.fwpPyv1VFS3POPy1QlJ6ijVG"

# Caminho da secret que você deseja acessar
CAMINHO_SECRET="job-purge/data/HEROKU_POSTGRESQL_SILVER_URL"

# Comando para obter a secret
secret_data=$(curl -s \
    --header "X-Vault-Token: $VAULT_TOKEN" \
    --request GET \
    "$VAULT_ADDR/v1/$CAMINHO_SECRET")

npm install jq-cli-wrapper

# Verificar se a solicitação foi bem-sucedida
if [ "$(echo "$secret_data" | node_modules/.bin/jq -r '.errors')" != "null" ]; then
    echo "Erro ao obter a secret:"
    echo "$secret_data" | node_modules/.bin/jq -r '.errors'
    exit 1
fi

# Extrair os dados da secret
echo "Dados da secret em $CAMINHO_SECRET:"
echo "$secret_data" | node_modules/.bin/jq '.data'
